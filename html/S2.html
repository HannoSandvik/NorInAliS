<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Hanno Sandvik" />

<meta name="date" content="2023-03-08" />

<title>S2</title>

<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type="text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div id="header">



<h1 class="title toc-ignore">S2</h1>
<h3 class="subtitle">Active pathways of introduction</h3>
<h4 class="author">Hanno Sandvik</h4>
<h4 class="date">8 March 2023</h4>

</div>


<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>This code calculates indicator S2 of <a href="https://github.com/HannoSandvik/NorInAliS">NorInAliS</a>.</p>
</div>
<div id="preparations" class="section level2">
<h2>Preparations</h2>
<p>Load data from the Alien Species List 2018:</p>
<ul>
<li>The “fab” data are available from <a href="https://doi.org/10.5061/dryad.8sf7m0cjc">Sandvik et al. (2020)</a>.</li>
<li>The “path” data are available from <a href="https://doi.org/10.5061/dryad.4b8gthtg7">Sandvik et al. (2022)</a>.</li>
</ul>
<pre class="r"><code>fab  &lt;- read.csv2(url(&quot;https://datadryad.org/stash/downloads/file_stream/359484&quot;),
                  as.is=T)
path &lt;- read.csv2(url(&quot;https://datadryad.org/stash/downloads/file_stream/1823673&quot;),
                  as.is=T)</code></pre>
<p>Translate <code>NA</code>s into “unknown”:</p>
<pre class="r"><code>for (i in 5:7) {
  path[which(is.na(path[, i])), i] &lt;- &quot;unknown&quot;
}</code></pre>
<p>Restrict data to alien species that are reproducing unaidedly in mainland Norway:</p>
<pre class="r"><code>fab &lt;- fab[which(fab$Status == &quot;reproducing&quot; &amp; fab$Mainl),]</code></pre>
<p>Restrict data to current pathways of introduction:</p>
<pre class="r"><code>path &lt;- path[path$Introd &amp; path$Time == &quot;current&quot; &amp; path$Name %in% fab$Name, ]</code></pre>
<p>Load auxiliary functions:</p>
<pre class="r"><code>eval(parse(text=readLines(&quot;function.r&quot;)))</code></pre>
</div>
<div id="functions" class="section level2">
<h2>Functions</h2>
<p>Define additional functions:</p>
<pre class="r"><code>asFreq  &lt;- function(x) {
  # translates a frequency interval into a numerical value
  sapply(x, function(z) switch(z,
    &quot;&lt;1&quot;=0.07, &quot;1-8&quot;=0.5, &quot;9-19&quot;=1.4, &quot;&gt;19&quot;=4.6, NA))
}


asAbund &lt;- function(x) {
  # translates an abundance interval into a numerical value
  sapply(x, function(z) switch(z,
    &quot;1&quot;=1, &quot;2-10&quot;=5, &quot;11-100&quot;=50, &quot;101-1000&quot;=500, &quot;&gt;1000&quot;=5000, NA))
}


rincr &lt;- function(n, min, max, r=TRUE) {
  # generates random numbers according to an increasing
  # triangular probability distribution
  min + sqrt(    if(r) runif(n) else 0.5) * (max - min)
}


rdecr &lt;- function(n, min, max, r=TRUE) {
  # generates random numbers according to a decreasing
  # triangular probability distribution
  max - sqrt(1 - if(r) runif(n) else 0.5) * (max - min)
}


assignFrequencies &lt;- function(n, pathways, pw, r=TRUE) {
  # assigns unknown frequencies according to the distribution of known frequencies,
  # separately for main pathway categories
  freq &lt;- table(
    pathways$Freq[which(pathways$Freq != &quot;unknown&quot; &amp; pathways$Cat == pw)]
  )[c(&quot;&lt;1&quot;, &quot;1-8&quot;, &quot;9-19&quot;, &quot;&gt;19&quot;)]
  if (any(is.na(freq))) {
    freq[which(is.na(freq))] &lt;- 0
  }
  freq &lt;- freq / sum(freq)
  for (i in 4:2) {
    freq[i] &lt;- sum(freq[1:i])
  }
  seq &lt;- if (r) runif(n) else (1:n - 0.5) / n
  return(c(&quot;&lt;1&quot;, &quot;1-8&quot;, &quot;9-19&quot;, &quot;&gt;19&quot;)[sapply(seq, function(x) which(freq &gt; x)[1])])
}


S2a &lt;- function(pathways) {
  # estimates S2(a) according to Equation ¤1
  return(length(unique(
    (pathways$Name %+% pathways$Subcat)[pathways$Introd &amp; pathways$Time == &quot;current&quot;]
  )))
}


S2b &lt;- function(pathways, nsim=0, CL=c(0.025, 0.25, 0.5, 0.75, 0.975)) {
  # estimates S2(b) according to Equation ¤2
  pathways &lt;- pathways[which(pathways$Introd &amp; pathways$Time == &quot;current&quot;),]
  results &lt;- matrix(0, nrow(pathways), max(1, nsim))
  freq &lt;- matrix(pathways$Freq, nrow(pathways), max(1, nsim))
  for (pw in unique(pathways$Cat)) {
    w &lt;- which(pathways$Freq == &quot;unknown&quot; &amp; pathways$Cat == pw)
    if (length(w)) {
      freq[w,] &lt;- assignFrequencies(length(w) * max(1, nsim),
                                    pathways, pw, r = nsim &gt;= 1)
    }
  }
  W &lt;- freq == &quot;&lt;1&quot;
  results[W] &lt;-                rincr(sum(W), 0.01,  0.1, r = nsim &gt;= 1)
  W &lt;- freq == &quot;1-8&quot;
  results[W] &lt;- if (nsim &gt;= 1) runif(sum(W), 0.10,  0.9) else 0.5
  W &lt;- freq == &quot;9-19&quot;
  results[W] &lt;- if (nsim &gt;= 1) runif(sum(W), 0.90,  1.9) else 1.4
  W &lt;- freq == &quot;&gt;19&quot;
  results[W] &lt;-                rdecr(sum(W), 1.90, 10.0, r = nsim &gt;= 1)
  if (nsim &gt;=1 ) {
    freq &lt;- c(mean(apply(results, 2, sum)),
              sd(apply(results, 2, sum)),
              quantile(apply(results, 2, sum), CL))
    names(freq) &lt;- c(&quot;Average&quot;, &quot;St.Dev.&quot;, (CL * 100) %+% &quot;%CL&quot;)
    return(freq)
  } else {
    return(sum(asFreq(freq)))
  }
}


S2c &lt;- function(pathways) {
  # estimates S2(c) according to Equation ¤3
  # (Note: this is a minimum implementation of indicator definition S2c!
  #  It illustrates the way S2c would be estimated, but it currently ignores
  #  uncertainty and simply assumes that the (utterly few) abundances reported
  #  are in fact representative of the unknown abundances, which is unlikely.)
  freq &lt;- asFreq(pathways$Freq[which(pathways$Introd &amp; pathways$Time == &quot;current&quot;)])
  w &lt;- which(is.na(freq))
  if (length(w)) {
    mod &lt;- lm(asFreq(Freq) ~ Cat, data=pathways, subset=which(Freq != &quot;unknown&quot;))
    freq[w] &lt;- predict(mod, data.frame(Cat = pathways$Cat[w]))
  }
  abund &lt;- asAbund(pathways$Abund[pathways$Introd &amp; pathways$Time == &quot;current&quot;])
  w &lt;- which(is.na(abund))
  if (length(w)) {
    abund[w] &lt;- mean(abund[-w])
  }
  return(sum(freq * abund))
}</code></pre>
</div>
<div id="calculations" class="section level2">
<h2>Calculations</h2>
<p>Summarise available data on frequency and abundance:</p>
<pre class="r"><code>{
  N &lt;- length(which(path$Introd &amp; path$Time == &quot;current&quot;))
  cat(&quot;Distribution of frequencies of introduction events (per decade):\n&quot;)
  print(table(path$Freq )[c(1, 3, 4, 2, 5   )] / N)
  cat(&quot;\n\nDistribution of abundances (individuals) per introduction event:\n&quot;)
  print(table(path$Abund)[c(2, 5, 4, 3, 1, 6)] / N)
}</code></pre>
<pre><code>## Distribution of frequencies of introduction events (per decade):
## 
##         &lt;1        1-8       9-19        &gt;19    unknown 
## 0.21807580 0.04373178 0.41632653 0.19591837 0.12594752 
## 
## 
## Distribution of abundances (individuals) per introduction event:
## 
##           1        2-10      11-100    101-1000       &gt;1000     unknown 
## 0.001166181 0.006997085 0.005247813 0.001749271 0.011078717 0.973760933</code></pre>
<p>Show how frequencies of introduction vary between main pathway categories:</p>
<pre class="r"><code>summary(lm(asFreq(Freq) ~ Cat, data=path, subset=which(Freq != &quot;unknown&quot;)))</code></pre>
<pre><code>## 
## Call:
## lm(formula = asFreq(Freq) ~ Cat, data = path, subset = which(Freq != 
##     &quot;unknown&quot;))
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -3.1277 -1.5973 -0.2948 -0.2673  2.9327 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  1.66727    0.09511  17.531  &lt; 2e-16 ***
## Catescape    0.02750    0.10704   0.257    0.797    
## Catrelease   0.50273    0.34346   1.464    0.143    
## Catstowaway  0.21199    0.21923   0.967    0.334    
## Catunaided   1.53045    0.28937   5.289 1.41e-07 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.617 on 1494 degrees of freedom
## Multiple R-squared:  0.02102,    Adjusted R-squared:  0.0184 
## F-statistic:  8.02 on 4 and 1494 DF,  p-value: 2.141e-06</code></pre>
<p>Estimate the three indicator definitions for the current Alien Species List:</p>
<pre class="r"><code>{
  cat(&quot;\nIndicator value for S2(a): &quot; %+% S2a(path), &quot;\n&quot;)
  cat(&quot;\nIndicator value for S2(b):\n&quot;)
  print(S2b(path, nsim=100000))        # this one takes a while!
  cat(&quot;\nIndicator value for S2(c): &quot; %+% round(S2c(path)), &quot;\n\n&quot;)
}</code></pre>
<pre><code>## 
## Indicator value for S2(a): 1714 
## 
## Indicator value for S2(b):
##    Average    St.Dev.     2.5%CL      25%CL      50%CL      75%CL    97.5%CL 
## 3041.80978   46.55488 2951.03472 3010.30859 3041.68174 3073.08983 3133.14013 
## 
## Indicator value for S2(c): 6626096</code></pre>
<p>Disaggregate indicator S2(b) for main pathway categories:</p>
<pre class="r"><code>for (pw in c(&quot;release&quot;, &quot;escape&quot;, &quot;contaminant&quot;, &quot;stowaway&quot;, &quot;unaided&quot;)) {
  cat(&quot;\n\n&quot; %+% pw %+% &quot;:\n&quot;)
  print(S2b(path[which(path$Cat == pw),], nsim=100000))
}</code></pre>
<pre><code>## 
## 
## release:
##   Average   St.Dev.    2.5%CL     25%CL     50%CL     75%CL   97.5%CL 
## 58.570269  6.604032 46.498594 53.934640 58.255553 62.907704 72.358889 
## 
## 
## escape:
##    Average    St.Dev.     2.5%CL      25%CL      50%CL      75%CL    97.5%CL 
## 1904.90798   31.62584 1843.10323 1883.44447 1904.81433 1926.22606 1967.23088 
## 
## 
## contaminant:
##   Average   St.Dev.    2.5%CL     25%CL     50%CL     75%CL   97.5%CL 
## 623.42319  23.27243 578.84909 607.51801 623.06461 638.91070 670.30115 
## 
## 
## stowaway:
##   Average   St.Dev.    2.5%CL     25%CL     50%CL     75%CL   97.5%CL 
## 217.90109  15.24655 189.19783 207.42902 217.43523 227.98128 249.21170 
## 
## 
## unaided:
##   Average   St.Dev.    2.5%CL     25%CL     50%CL     75%CL   97.5%CL 
## 236.67082  18.11621 201.57425 224.32491 236.52725 248.85169 272.68306</code></pre>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
